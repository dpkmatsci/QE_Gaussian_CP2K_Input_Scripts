&GLOBAL
  ! the project name is made part of most output files... useful to keep order 
  PROJECT Silicazslab_epoxywtr
  ! various runtypes (energy, geo_opt, etc.) available.
  PRINT_LEVEL LOW
  EXTENDED_FFT_LENGTHS T
  RUN_TYPE MD            
&END GLOBAL

&FORCE_EVAL
  ! the electronic structure part of CP2K is named Quickstep
  METHOD Quickstep
  STRESS_TENSOR ANALYTICAL

  &DFT
    ! basis sets and pseudopotential files can be found in cp2k/data
    BASIS_SET_FILE_NAME ../../../cp2k-data/BASIS_MOLOPT
    POTENTIAL_FILE_NAME ../../../cp2k-data/GTH_POTENTIALS
    ! Charge and multiplicity
    CHARGE 0
    MULTIPLICITY 1
    SURFACE_DIPOLE T
    SURF_DIP_DIR Z
    SURF_DIP_POS 58

    &MGRID
      NGRIDS 4
      CUTOFF 1000
      REL_CUTOFF 70
    &END MGRID

    &QS
       ! use the GPW method (i.e. pseudopotential based calculations with the Gaussian and Plane Waves scheme).
       METHOD GPW 
       ! default threshold for numerics ~ roughly numerical accuracy of the total energy per electron,
       ! sets reasonable values for all other thresholds.
       EPS_DEFAULT 1.0E-12
       EXTRAPOLATION ASPC ! For MD use ASPC method
    &END QS

  !  # The number of k-points should be taken from 03_kpoint_conv
  !  &KPOINTS
  !     SCHEME MONKHORST-PACK 14 14 10
  !  &END KPOINTS

    &POISSON
       PERIODIC XYZ ! the default, gas phase systems should have 'NONE' and a wavelet solver
       POISSON_SOLVER PERIODIC
    &END

    &SCF
       EPS_SCF 1e-06
       MAX_SCF 200
       SCF_GUESS ATOMIC
      ! CHOLESKY INVERSE
      ! ADDED_MOS 200
       &MIXING T
          ALPHA 0.2
          BETA 1.5
          METHOD BROYDEN_MIXING
          NBUFFER 10
       &END MIXING
       !&DIAGONALIZATION T
       !   ALGORITHM STANDARD
       !&END DIAGONALIZATION
      ! &SMEAR T
      !    METHOD FERMI_DIRAC
      !    ELECTRONIC_TEMPERATURE 300
      ! &END SMEAR
       &OT ON
        MINIMIZER CG ! DIIS can be used alternatively
       &END OT
       &OUTER_SCF ! repeat the inner SCF cycle 20 times
         MAX_SCF 20
         EPS_SCF 1.0E-6 ! must match the above
       &END
    &END SCF

    &XC
      &XC_FUNCTIONAL PBE
      &END XC_FUNCTIONAL
      ! adding Grimme's D3 correction (by default without C9 terms) 
      &VDW_POTENTIAL
         POTENTIAL_TYPE PAIR_POTENTIAL 
         &PAIR_POTENTIAL
            PARAMETER_FILE_NAME ../../../cp2k-data/dftd3.dat
            TYPE DFTD3(BJ)
            REFERENCE_FUNCTIONAL PBE
            CALCULATE_C9_TERM .TRUE.
            R_CUTOFF [angstrom] 20
         &END PAIR_POTENTIAL
      &END VDW_POTENTIAL
    &END XC
  &END DFT

  &SUBSYS
    &CELL
      A  19.87542054     0.00000000    0.00000000
      B   0.00000000    19.87542054    0.00000000
      C   0.00000000     0.00000000   60.00000000
    &END CELL
    &TOPOLOGY
      COORD_FILE_NAME silica_zslabepoxywtroptdft_rlxd.xyz
      COORD_FILE_FORMAT XYZ
    &END
    &KIND Si
      BASIS_SET DZVP-MOLOPT-SR-GTH-q4
      POTENTIAL GTH-PBE-q4
    &END KIND
    &KIND O
      BASIS_SET DZVP-MOLOPT-SR-GTH-q6
      POTENTIAL GTH-PBE-q6
    &END KIND
    &KIND H
      BASIS_SET DZVP-MOLOPT-SR-GTH-q1
      POTENTIAL GTH-PBE-q1
    &END KIND
    &KIND C
      BASIS_SET DZVP-MOLOPT-SR-GTH-q4
      POTENTIAL GTH-PBE-q4
    &END KIND
    &KIND N
      BASIS_SET DZVP-MOLOPT-SR-GTH-q5
      POTENTIAL GTH-PBE-q5
    &END KIND
  &END SUBSYS
&END FORCE_EVAL

! how to propagate the system, selection via RUN_TYPE in the &GLOBAL section
&MOTION
 &MD
   ENSEMBLE NVT  ! sampling the canonical ensemble, accurate properties might need NVE
   TEMPERATURE [K] 300
   TIMESTEP [fs] 0.5
   STEPS 1000
   # GLE thermostat as generated at http://epfl-cosmo.github.io/gle4md 
   # GLE provides an effective NVT sampling.
   &THERMOSTAT
     REGION MASSIVE
     TYPE NOSE
     &NOSE
       TIMECON 100    
     &END NOSE
   &END THERMOSTAT
   &PRINT 
    &ENERGY
        &EACH
           MD 2
        &END
    &END ENERGY
    &PROGRAM_RUN_INFO
        &EACH
           MD 20
        &END
    &END PROGRAM_RUN_INFO
   &END PRINT
 &END MD
 &PRINT 
  &TRAJECTORY
     &EACH
        MD 2
     &END
  &END TRAJECTORY
   &RESTART_HISTORY
     &EACH
       MD 10
     &END EACH
   &END RESTART_HISTORY
   &RESTART
     BACKUP_COPIES 3
     &EACH
       MD 20
     &END EACH
   &END RESTART
 &END PRINT
&END
&EXT_RESTART
  RESTART_FILE_NAME Silicazslab_epoxywtr-1.restart
&END